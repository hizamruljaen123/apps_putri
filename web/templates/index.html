<!doctype html>
<html>
  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/main.css') }}">
  </head>
  <body class="bg-gray-100">
    <div class="flex min-h-screen">
      <!-- Sidebar -->
      <div id="sidebar" class="bg-gray-800 text-white w-64 p-4 hidden md:block">
        <h2 class="text-2xl font-bold mb-4">Dashboard</h2>
        <nav>
          <ul>
            <li class="mb-2"><a href="#" class="text-gray-300 hover:text-white">Home</a></li>
            <li class="mb-2"><a href="/visualisasi" class="text-gray-300 hover:text-white">Visualisasi Data</a></li>
            <li class="mb-2"><button onclick="openModalInput()" class="text-gray-300 hover:text-white">New Smartphone Data</a></li>
          </ul>
        </nav>
      </div>
      <!-- Main Content -->
      <div class="flex-1 p-6">
        <div class="flex justify-between items-center mb-4">
          <h1 class="text-3xl font-bold">Dashboard</h1>
          <button class="md:hidden text-gray-800" onclick="toggleSidebar()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"></path>
        </svg>
        </button>
        <div class="w-full max-w-sm p-4">
          <div class="grid grid-cols-2 gap-4">
              <button onclick="showData('tm_store')" class="bg-blue-500 text-white py-2 px-4 rounded w-full">TM Store</button>
              <button onclick="showData('jaya_com')" class="bg-green-500 text-white py-2 px-4 rounded w-full">Jaya Com</button>
          </div>
      </div>
      </div>
      <!-- Combined Card -->
      <div class="bg-white p-6 rounded-lg shadow mb-6">
        <div id="loading-screen" class="fixed inset-0 bg-white bg-opacity-75 flex items-center justify-center z-50 hidden">
          <img src="https://www.davidkingsbury.co.uk/wp-content/uploads/2021/08/lg.ring-loading-gif.gif" alt="Loading..." class="w-16 h-16">
      </div>
        <h2 class="text-xl font-bold mb-4">Statistik Penjualan</h2>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <!-- Counters -->
          <div class="flex flex-col space-y-4">
            <div class="bg-green-100 p-4 rounded-lg shadow">
              <h3 class="text-lg font-bold text-green-600">Merek</h3>
              <div class="text-3xl font-bold text-gray-900" id="unique-merek">0</div>
              <span class="text-gray-500">Jumlah Merek</span>
            </div>
            <div class="bg-blue-100 p-4 rounded-lg shadow">
              <h3 class="text-lg font-bold text-blue-600">Tipe</h3>
              <div class="text-3xl font-bold text-gray-900" id="unique-tipe">0</div>
              <span class="text-gray-500">Jumlah Tipe</span>
            </div>
            <div class="bg-yellow-100 p-4 rounded-lg shadow">
              <h3 class="text-lg font-bold text-yellow-600">Bulan</h3>
              <div class="text-3xl font-bold text-gray-900" id="unique-bulan">0</div>
              <span class="text-gray-500">Jumlah Bulan</span>
            </div>
            <div class="bg-red-100 p-4 rounded-lg shadow">
              <h3 class="text-lg font-bold text-red-600">Cluster</h3>
              <div class="text-3xl font-bold text-gray-900" id="unique-cluster">0</div>
              <span class="text-gray-500">Jumlah Titik Cluster</span>
            </div>
          </div>
          <!-- Table -->
          <div class="flex flex-col">
            <h3 class="text-lg font-semibold mb-2">Kategori Penjualan</h3>
            <div class="overflow-x-auto overflow-y-auto h-64">
              <table class="min-w-full bg-white text-sm">
                <thead>
                  <tr class="bg-gray-200 text-gray-600 uppercase text-xs leading-normal">
                    <th class="py-3 px-4 text-left">Kategori Penjualan</th>
                    <th class="py-3 px-4 text-left">Jumlah</th>
                  </tr>
                </thead>
                <tbody id="summary-table-body" class="text-gray-600 text-xs font-light">
                  <!-- Summary data will be appended here by JavaScript -->
                </tbody>
              </table>
            </div>
          </div>
        </div>
      </div>
      <!-- Tabs -->
      <div class="bg-white p-4 rounded-lg shadow mb-6">
        <ul class="flex border-b">
          <li class="mr-1">
            <button class="bg-white inline-block py-2 px-4 text-blue-700 font-semibold" onclick="fetchDataAndDisplay()">Daftar Cluster</button>
          </li>
          <li class="mr-1">
            <button class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800" onclick="fetchSalesData('tab-penjualan', 'data-table-penjualan')">Daftar Penjualan</button>
          </li>
          <li class="mr-1">
            <button class="bg-white inline-block py-2 px-4 text-blue-500 hover:text-blue-800" onclick="fetchSalesData('tab-spesifikasi', 'data-table-spesifikasi')">Daftar Spesifikasi</button>
          </li>
        </ul>
        <div id="tab-content">
          <div id="tab-cluster" class="p-4">
            <h2 class="text-xl font-bold mb-4">Data Cluster</h2>
            <div class="overflow-x-auto overflow-y-auto h-96">
              <div class="overflow-x-auto">
                 <!-- Pagination controls -->
                
                <table class="min-w-full bg-white text-sm">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs leading-normal">
                            <th class="py-3 px-4 text-left">No</th>
                            <th class="py-3 px-4 text-left">Cluster</th>
                            <th class="py-3 px-4 text-left">Kategori Penjualan</th>
                            <th class="py-3 px-4 text-left">Bulan</th>
                            <th class="py-3 px-4 text-left">Merek</th>
                            <th class="py-3 px-4 text-left">Persentase Jumlah Terjual</th>
                            <th class="py-3 px-4 text-left">Tipe</th>
                        </tr>
                    </thead>
                    <tbody id="data-table-cluster" class="text-gray-600 text-xs font-light">
                        <!-- Data akan dimuat di sini oleh JavaScript -->
                    </tbody>
                </table>
              </div>
              <br>
  
            </div>
            <br>
            <div id="pagination" class="flex justify-center items-center mt-6 w-full">
              <!-- Pagination links will be appended here by JavaScript -->
          </div>
          </div>
          <div id="tab-penjualan" class="p-4 hidden">
            <h2 class="text-xl font-bold mb-4">Data Penjualan</h2>
            <div id="data-table-penjualan-container" class="overflow-x-auto overflow-y-auto h-96">
              <!-- Data will be appended here by JavaScript -->
            </div>
          </div>
          <div id="tab-spesifikasi" class="p-4 hidden">
            <h2 class="text-xl font-bold mb-4">Data Spesifikasi</h2>
            <div id="data-table-spesifikasi-container" class="overflow-x-auto overflow-y-auto h-96">
              <!-- Data will be appended here by JavaScript -->
            </div>
          </div>
        </div>
      </div>
      
    </div>
  </div>
  <!-- Modal -->
  <div id="image-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
    <div class="flex items-center justify-center min-h-screen p-4 text-center sm:block sm:p-0">
      <div class="fixed inset-0 bg-gray-500 opacity-75"></div>
      <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
      <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-6xl w-full max-w-full">
        <div class="absolute top-2 right-2">
          <button type="button" class="inline-flex justify-center rounded-full p-2 bg-gray-200 hover:bg-gray-300 text-gray-500 hover:text-gray-800 focus:outline-none" onclick="closeModal()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
        </svg>
        </button>
      </div>
      <div class="flex justify-center items-center">
        <div>
          <div class="mx-auto flex items-center justify-center h-12 w-12 rounded-full bg-green-100">
            <!-- Icon here -->
          </div>
          <div class="mt-3 text-center sm:mt-5">
            <h3 class="text-lg leading-6 font-medium text-gray-900" id="modal-title"></h3>
            <div class="mt-2">
              <img id="modal-image" src="" alt="" class="w-full h-auto">
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
<!-- Modal for Input Forms -->
<!-- Modal for Input Forms -->
<div id="input-modal" class="fixed z-10 inset-0 overflow-y-auto hidden">
  <div class="flex items-center justify-center min-h-screen p-4 text-center sm:block sm:p-0">
    <div class="fixed inset-0 bg-gray-500 opacity-75"></div>
    <span class="hidden sm:inline-block sm:align-middle sm:h-screen" aria-hidden="true">&#8203;</span>
    <div class="inline-block align-bottom bg-white rounded-lg px-4 pt-5 pb-4 text-left overflow-hidden shadow-xl transform transition-all sm:my-8 sm:align-middle sm:max-w-xl w-full max-w-full">
      <div class="absolute top-2 right-2">
        <button type="button" class="inline-flex justify-center rounded-full p-2 bg-gray-200 hover:bg-gray-300 text-gray-500 hover:text-gray-800 focus:outline-none" onclick="closeInputModal()">
          <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18L18 6M6 6l12 12"></path>
          </svg>
        </button>
      </div>
      <div class="sm:flex sm:items-start">
        <div class="mt-3 text-center sm:mt-0 sm:text-left w-full">
          <h3 id="input-modal-title" class="text-lg font-medium leading-6 text-gray-900">Tambah Data Smartphone</h3>
          <div id="input-modal-content" class="mt-2">
            <div id="form-container" class="space-y-4">
              <form id="form-data" class="space-y-4">
                <div class="flex space-x-4">
                  <!-- Data Penjualan Form -->
                  <div id="data-penjualan-form" class="w-1/2">
                    <h4 class="text-lg font-semibold mb-2">Data Penjualan</h4>
                    <div class="grid grid-cols-1 gap-4">
                      <div>
                        <label for="jumlah-penjualan" class="block text-sm font-medium text-gray-700">Jumlah Penjualan</label>
                        <input type="number" id="jumlah-penjualan" name="jumlah-penjualan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                      </div>
                      <div>
                        <label for="total-penjualan" class="block text-sm font-medium text-gray-700">Total Penjualan</label>
                        <input type="number" id="total-penjualan" name="total-penjualan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                      </div>
                      <div>
                        <label for="tahun" class="block text-sm font-medium text-gray-700">Tahun</label>
                        <select id="tahun" name="tahun" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="2020">2020</option>
                          <option value="2021">2021</option>
                          <option value="2022">2022</option>
                          <option value="2023">2023</option>
                          <option value="2024">2024</option>
                          <option value="2025">2025</option>
                        </select>
                      </div>
                      <div>
                        <label for="bulan" class="block text-sm font-medium text-gray-700">Bulan</label>
                        <select id="bulan" name="bulan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="Januari">Januari</option>
                          <option value="Februari">Februari</option>
                          <option value="Maret">Maret</option>
                          <option value="April">April</option>
                          <option value="Mei">Mei</option>
                          <option value="Juni">Juni</option>
                          <option value="Juli">Juli</option>
                          <option value="Agustus">Agustus</option>
                          <option value="September">September</option>
                          <option value="Oktober">Oktober</option>
                          <option value="November">November</option>
                          <option value="Desember">Desember</option>
                        </select>
                      </div>
                    </div>
                  </div>
                  <!-- Data Spesifikasi Form -->
                  <div id="data-spesifikasi-form" class="w-1/2">
                    <h4 class="text-lg font-semibold mb-2">Data Spesifikasi</h4>
                    <div class="grid grid-cols-1 gap-4">
                      <div>
                        <label for="merek" class="block text-sm font-medium text-gray-700">Merek</label>
                        <select id="merek" name="merek" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="Realme">Realme</option>
                          <option value="Samsung">Samsung</option>
                          <option value="Infinix">Infinix</option>
                          <option value="Apple">Apple</option>
                          <option value="Lenovo">Lenovo</option>
                          <option value="Oppo">Oppo</option>
                          <option value="Huawei">Huawei</option>
                          <option value="Xiaomi">Xiaomi</option>
                          <option value="Asus">Asus</option>
                          <option value="Vivo">Vivo</option>
                        </select>
                      </div>
                      <div>
                        <label for="ram" class="block text-sm font-medium text-gray-700">RAM</label>
                        <select id="ram" name="ram" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="2 GB">2 GB</option>
                          <option value="4 GB">4 GB</option>
                          <option value="6 GB">6 GB</option>
                          <option value="8 GB">8 GB</option>
                          <option value="12 GB">12 GB</option>
                        </select>
                      </div>
                      <div>
                        <label for="memori-internal" class="block text-sm font-medium text-gray-700">Memori Internal</label>
                        <select id="memori-internal" name="memori-internal" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="32 GB">32 GB</option>
                          <option value="64 GB">64 GB</option>
                          <option value="128 GB">128 GB</option>
                          <option value="256 GB">256 GB</option>
                          <option value="512 GB">512 GB</option>
                          <option value="1 TB">1 TB</option>
                        </select>
                      </div>
                      <div>
                        <label for="kamera-utama" class="block text-sm font-medium text-gray-700">Kamera Utama (MP)</label>
                        <select id="kamera-utama" name="kamera-utama" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="12 MP">12 MP</option>
                          <option value="16 MP">16 MP</option>
                          <option value="48 MP">48 MP</option>
                          <option value="64 MP">64 MP</option>
                          <option value="108 MP">108 MP</option>
                        </select>
                      </div>
                      <div>
                        <label for="kamera-depan" class="block text-sm font-medium text-gray-700">Kamera Depan (MP)</label>
                        <select id="kamera-depan" name="kamera-depan" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="8 MP">8 MP</option>
                          <option value="12 MP">12 MP</option>
                          <option value="16 MP">16 MP</option>
                          <option value="20 MP">20 MP</option>
                          <option value="32 MP">32 MP</option>
                        </select>
                      </div>
                      <div>
                        <label for="baterai" class="block text-sm font-medium text-gray-700">Baterai (mAh)</label>
                        <select id="baterai" name="baterai" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="3000 mAh">3000 mAh</option>
                          <option value="4000 mAh">4000 mAh</option>
                          <option value="5000 mAh">5000 mAh</option>
                          <option value="6000 mAh">6000 mAh</option>
                          <option value="7000 mAh">7000 mAh</option>
                        </select>
                      </div>
                      <div>
                        <label for="jenis-layar" class="block text-sm font-medium text-gray-700">Jenis Layar</label>
                        <select id="jenis-layar" name="jenis-layar" class="mt-1 block w-full px-3 py-2 border border-gray-300 rounded-md shadow-sm focus:outline-none focus:ring-indigo-500 focus:border-indigo-500 sm:text-sm">
                          <option value="LCD">LCD</option>
                          <option value="OLED">OLED</option>
                          <option value="AMOLED">AMOLED</option>
                          <option value="Super AMOLED">Super AMOLED</option>
                        </select>
                      </div>
                    </div>
                  </div>
                </div>
                <div class="mt-4">
                  <button type="submit" class="inline-flex justify-center py-2 px-4 border border-transparent rounded-md shadow-sm text-white bg-indigo-600 hover:bg-indigo-700 focus:outline-none focus:ring-2 focus:ring-offset-2 focus:ring-indigo-500 w-full">Save Data</button>
                </div>
              </form>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>
</div>


<!-- JS Scripts -->
<script>
 // Fetch and format sales data
 async function fetchSalesData(tabId, tableId) {
        try {
            const response = await fetch('/fetch-data');

            if (!response.ok) {
                throw new Error(`HTTP error! status: ${response.status}`);
            }

            const result = await response.json();

            if (result.status !== 'success') {
                throw new Error(result.error || 'Unknown error occurred');
            }

            const data = result.data;

            const tableContainer = document.getElementById(`${tableId}-container`);
            tableContainer.innerHTML = ''; // Clear existing table data

            let tableHTML = `
                <table class="min-w-full bg-white text-sm">
                    <thead>
                        <tr class="bg-gray-200 text-gray-600 uppercase text-xs leading-normal">
                            <th class="py-3 px-4 text-left">No</th>
                            <th class="py-3 px-4 text-left">Merek</th>
                            <th class="py-3 px-4 text-left">Tipe</th>
                            ${tableId === 'data-table-penjualan' ? `
                                <th class="py-3 px-4 text-left">Bulan</th>
                                <th class="py-3 px-4 text-left">Jumlah Stok</th>
                                <th class="py-3 px-4 text-left">Jumlah Terjual</th>
                                <th class="py-3 px-4 text-left">Harga Satuan Rp</th>
                                <th class="py-3 px-4 text-left">Total Penjualan Rp</th>
                            ` : `
                                <th class="py-3 px-4 text-left">Kamera Utama MP</th>
                                <th class="py-3 px-4 text-left">Kamera Depan MP</th>
                                <th class="py-3 px-4 text-left">RAM</th>
                                <th class="py-3 px-4 text-left">Memori Internal</th>
                                <th class="py-3 px-4 text-left">Baterai mAh</th>
                                <th class="py-3 px-4 text-left">Jenis Layar</th>
                            `}
                        </tr>
                    </thead>
                    <tbody class="text-gray-600 text-xs font-light">
            `;

            data.forEach((item, index) => {
                tableHTML += `
                    <tr class="border-b border-gray-200 hover:bg-gray-100">
                        <td class="py-3 px-6 text-left">${index + 1}</td>
                        <td class="py-3 px-6 text-left">${item.Merek || '-'}</td>
                        <td class="py-3 px-6 text-left">${item.Tipe || '-'}</td>
                        ${tableId === 'data-table-penjualan' ? `
                            <td class="py-3 px-6 text-left">${item.Bulan || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.Jumlah_Stok || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.Jumlah_Terjual || '-'}</td>
                            <td class="py-3 px-6 text-left">${formatRupiah(item.Harga_Satuan_Rp) || '-'}</td>
                            <td class="py-3 px-6 text-left">${formatRupiah(item.Total_Penjualan_Rp) || '-'}</td>
                        ` : `
                            <td class="py-3 px-6 text-left">${item.Kamera_Utama_MP || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.Kamera_Depan_MP || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.RAM || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.Memori_Internal || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.Baterai_mAh || '-'}</td>
                            <td class="py-3 px-6 text-left">${item.Jenis_Layar || '-'}</td>
                        `}
                    </tr>
                `;
            });

            tableHTML += `
                    </tbody>
                </table>
            `;

            tableContainer.innerHTML = tableHTML;

            // Show the appropriate tab content
            document.querySelectorAll('#tab-content > div').forEach(div => div.classList.add('hidden'));
            document.getElementById(tabId).classList.remove('hidden');
        } catch (error) {
            console.error('Error fetching sales data:', error);
            // Optionally, display error message to user
            const errorMessage = document.getElementById('error-message');
            if (errorMessage) {
                errorMessage.textContent = `Failed to fetch data: ${error.message}`;
                errorMessage.style.display = 'block';
            }
        }
    }

    function formatRupiah(value) {
    // Replace null with 0
    if (value === null) {
        value = 0;
    }
    
    // Convert the value to a locale string in Indonesian Rupiah format
    return value.toLocaleString('id-ID', { style: 'currency', currency: 'IDR' });
}

</script>
</body>
</html>